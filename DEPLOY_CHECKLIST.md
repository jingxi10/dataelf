# 部署检查清单

使用此清单确保部署过程完整无误。

## 部署前准备

### 服务器环境
- [ ] 服务器操作系统已确认（Ubuntu/CentOS/Debian）
- [ ] 服务器IP地址已记录
- [ ] 域名已解析到服务器IP
- [ ] SSH访问已配置
- [ ] 防火墙规则已规划

### 软件安装
- [ ] Java 17已安装 (`java -version`)
- [ ] Nginx已安装 (`nginx -v`)
- [ ] Git已安装（如需要）
- [ ] 必要的工具已安装（curl, wget, unzip等）

### 数据库和Redis
- [ ] MySQL数据库已创建
- [ ] 数据库用户已创建并授权
- [ ] Redis服务已启动
- [ ] Redis密码已设置（如需要）
- [ ] 可以从服务器访问数据库和Redis

### SSL证书
- [ ] 已决定使用Let's Encrypt或自有证书
- [ ] 域名DNS已正确解析
- [ ] 80和443端口已开放

---

## 后端部署检查

### 文件准备
- [ ] 后端JAR文件已构建 (`mvn clean package`)
- [ ] JAR文件已上传到服务器
- [ ] 配置文件已创建 (`application-prod.yml`)
- [ ] 环境变量文件已创建 (`.env`)

### 配置检查
- [ ] 数据库连接信息正确
- [ ] Redis连接信息正确
- [ ] JWT密钥已修改（不是默认值）
- [ ] 应用基础URL已设置为HTTPS域名
- [ ] CORS配置包含前端域名
- [ ] 阿里云OSS配置已填写（如使用）
- [ ] 邮件服务配置已填写（如使用）

### 服务配置
- [ ] Systemd服务文件已创建
- [ ] 服务已启用 (`systemctl enable`)
- [ ] 服务已启动 (`systemctl start`)
- [ ] 服务状态正常 (`systemctl status`)
- [ ] 日志目录权限正确

### 功能验证
- [ ] 后端服务可以访问 (`curl http://localhost:8080/actuator/health`)
- [ ] 数据库连接正常（查看日志）
- [ ] Redis连接正常（查看日志）
- [ ] 日志文件正常生成

---

## 前端部署检查

### 文件准备
- [ ] 前端已构建 (`npm run build`)
- [ ] dist目录文件已上传到服务器
- [ ] 文件权限已设置（www-data用户）

### 配置检查
- [ ] API基础URL已配置为HTTPS地址
- [ ] 前端路由配置正确

---

## Nginx配置检查

### 基本配置
- [ ] Nginx配置文件已创建
- [ ] 站点已启用 (`ln -s sites-available sites-enabled`)
- [ ] Nginx配置测试通过 (`nginx -t`)
- [ ] Nginx已重新加载 (`systemctl reload nginx`)

### HTTP配置
- [ ] HTTP端口（80）监听正常
- [ ] HTTP到HTTPS重定向配置正确
- [ ] Let's Encrypt验证路径配置正确（如使用）

### HTTPS配置
- [ ] SSL证书已获取/上传
- [ ] SSL证书路径配置正确
- [ ] SSL证书文件权限正确（key文件600）
- [ ] HTTPS端口（443）监听正常
- [ ] SSL协议版本配置正确（TLSv1.2+）
- [ ] 安全头已配置

### 代理配置
- [ ] 前端静态文件路径正确
- [ ] API代理配置正确 (`/api` -> `http://127.0.0.1:8080`)
- [ ] 上传文件代理配置正确
- [ ] 代理头设置正确（X-Forwarded-Proto等）
- [ ] 文件上传大小限制已设置（100M）

### 性能优化
- [ ] Gzip压缩已启用
- [ ] 静态资源缓存已配置
- [ ] HTTP/2已启用

---

## 防火墙和安全检查

### 防火墙
- [ ] SSH端口（22）已开放
- [ ] HTTP端口（80）已开放
- [ ] HTTPS端口（443）已开放
- [ ] 不必要的端口已关闭

### 安全配置
- [ ] 强密码已设置
- [ ] SSH密钥认证已配置（推荐）
- [ ] 不必要的服务已禁用
- [ ] 日志轮转已配置

---

## 功能测试

### 前端访问
- [ ] 可以通过HTTPS访问前端 (`https://your-domain.com`)
- [ ] 前端页面正常加载
- [ ] 静态资源正常加载
- [ ] HTTP自动重定向到HTTPS

### API测试
- [ ] API请求正常 (`https://your-domain.com/api/actuator/health`)
- [ ] 登录功能正常
- [ ] 文件上传功能正常
- [ ] CORS配置正确（无跨域错误）

### 数据库和Redis
- [ ] 数据库操作正常
- [ ] Redis缓存正常
- [ ] 会话管理正常

---

## 监控和维护

### 日志配置
- [ ] 后端日志文件正常生成
- [ ] Nginx访问日志正常
- [ ] Nginx错误日志正常
- [ ] 日志轮转已配置

### 监控
- [ ] 服务健康检查正常
- [ ] 日志监控已设置（可选）
- [ ] 性能监控已设置（可选）

### 备份
- [ ] 数据库备份策略已制定
- [ ] 配置文件备份已制定
- [ ] 备份脚本已测试

---

## SSL证书续期（Let's Encrypt）

- [ ] 自动续期已配置 (`certbot renew`)
- [ ] 续期测试通过 (`certbot renew --dry-run`)
- [ ] 续期后Nginx自动重载已配置

---

## 性能优化检查

- [ ] JVM参数已优化
- [ ] 数据库连接池已配置
- [ ] Redis连接池已配置
- [ ] Nginx缓存已配置
- [ ] CDN已配置（如使用）

---

## 最终验证

### 完整功能测试
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 内容创建功能正常
- [ ] 内容审核功能正常
- [ ] 文件上传功能正常
- [ ] 邮件发送功能正常（如使用）

### 性能测试
- [ ] 页面加载速度正常
- [ ] API响应时间正常
- [ ] 并发访问测试通过

### 安全检查
- [ ] HTTPS强制启用
- [ ] 敏感信息未泄露
- [ ] 密码强度要求正常
- [ ] SQL注入防护正常
- [ ] XSS防护正常

---

## 部署完成确认

- [ ] 所有检查项已完成
- [ ] 所有功能测试通过
- [ ] 文档已更新
- [ ] 团队已通知

---

## 问题记录

如遇到问题，请记录：

1. **问题描述**：
2. **错误信息**：
3. **解决步骤**：
4. **最终结果**：

---

**部署日期**：_____________  
**部署人员**：_____________  
**验证人员**：_____________  
**备注**：_____________
