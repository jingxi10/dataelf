# 用户注册和登录功能实现说明

## 实现概述

本次实现完成了任务17：实现前端用户注册和登录页面，包括以下功能：

### 1. 创建的文件

#### API 服务层
- `frontend/src/api/auth.js` - 认证相关的API调用封装
  - `register()` - 用户注册
  - `login()` - 用户登录
  - `getCurrentUser()` - 获取当前用户信息
  - `logout()` - 用户登出

#### 视图组件
- `frontend/src/views/auth/RegisterView.vue` - 用户注册页面
- `frontend/src/views/auth/LoginView.vue` - 用户登录页面

### 2. 功能特性

#### 注册页面 (RegisterView.vue)
✅ **表单字段**
- 邮箱输入（带格式验证）
- 手机号输入（带格式验证）
- 密码输入（带强度验证）
- 确认密码输入（带一致性验证）

✅ **表单验证**
- 邮箱格式验证：`/^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/`
- 手机号格式验证：`/^1[3-9]\d{9}$/`
- 密码强度验证：
  - 至少8个字符
  - 包含至少一个大写字母
  - 包含至少一个小写字母
  - 包含至少一个数字
- 确认密码一致性验证

✅ **审核状态显示**
- 注册成功后显示模态对话框
- 提示用户"账号正在审核中，请留意查看邮箱"
- 提供"前往登录"按钮

✅ **后端API集成**
- 调用 `/api/auth/register` 接口
- 处理验证错误并显示字段级错误信息
- 处理成功响应并显示成功对话框

✅ **用户体验**
- 美观的渐变背景
- 响应式卡片布局
- Element Plus 组件库集成
- 图标支持
- 加载状态显示

#### 登录页面 (LoginView.vue)
✅ **表单字段**
- 邮箱输入（带格式验证）
- 密码输入

✅ **表单验证**
- 邮箱格式验证
- 密码必填验证
- 支持回车键提交

✅ **审核状态显示**
- 根据不同错误代码显示不同的账号状态提示：
  - `ACCOUNT_PENDING` - 显示"账号审核中"警告
  - `ACCOUNT_EXPIRED` - 显示"账号已到期"错误
  - `ACCOUNT_REJECTED` - 显示"账号审核未通过"错误
  - `INVALID_CREDENTIALS` - 显示"邮箱或密码错误"错误

✅ **后端API集成**
- 调用 `/api/auth/login` 接口
- 保存JWT令牌到localStorage
- 保存用户信息到Pinia store
- 登录成功后重定向到目标页面或首页

✅ **路由守卫**
- 已登录用户访问登录页自动重定向到首页
- 支持登录后重定向到原目标页面（通过query参数）

### 3. 需求验证

根据需求文档验证：

#### 需求 1.1 - 用户提交注册表单验证
✅ 实现了邮箱格式、手机号格式和密码强度的前端验证
✅ 后端验证失败时显示详细的字段级错误信息

#### 需求 1.2 - 注册成功提示
✅ 注册成功后显示"等待审核，请留意查看邮箱"提示
✅ 使用模态对话框展示，用户体验良好

#### 需求 1.4 - 账号批准后可登录
✅ 登录功能完整实现
✅ 成功登录后保存认证信息并重定向

#### 需求 1.5 - 未审核账号无法登录
✅ 实现了账号状态检查
✅ 未审核账号登录时显示"账号审核中"提示
✅ 过期账号登录时显示"账号已到期"提示

### 4. 技术实现细节

#### 状态管理
- 使用 Pinia store (`useAuthStore`) 管理认证状态
- 令牌持久化到 localStorage
- 提供 `isAuthenticated` 和 `isAdmin` 计算属性

#### HTTP 拦截器
- 请求拦截器：自动添加 JWT 令牌到请求头
- 响应拦截器：
  - 统一处理响应数据格式
  - 401错误自动清除认证信息并重定向到登录页
  - 其他错误显示友好的错误提示

#### 路由配置
- `/register` - 注册页面
- `/login` - 登录页面
- 路由守卫：需要认证的页面自动重定向到登录页

#### 样式设计
- 遵循设计系统要求
- 使用渐变背景（紫色系）
- 卡片化设计
- 响应式布局
- 自定义 Element Plus 主题色

### 5. 与后端API对接

后端API端点：
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录

响应格式：
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    // 实际数据
  }
}
```

错误响应格式：
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误信息",
    "details": [
      {
        "field": "字段名",
        "message": "字段错误信息"
      }
    ]
  }
}
```

### 6. 测试建议

#### 手动测试场景
1. **注册流程**
   - 测试各种无效输入（邮箱、手机号、密码）
   - 测试密码不一致情况
   - 测试注册成功流程
   - 验证成功对话框显示

2. **登录流程**
   - 测试邮箱格式验证
   - 测试错误的邮箱/密码
   - 测试未审核账号登录
   - 测试过期账号登录
   - 测试成功登录和重定向

3. **响应式测试**
   - 测试不同屏幕尺寸下的布局
   - 测试移动设备上的表单输入

#### 集成测试
- 需要后端服务运行
- 测试完整的注册-审核-登录流程
- 测试JWT令牌的生成和验证

### 7. 后续工作

本任务已完成所有要求的功能。后续可以考虑：
- 添加"忘记密码"功能
- 添加第三方登录（如果需要）
- 添加验证码功能（防止机器人注册）
- 添加更多的表单验证规则
- 优化移动端体验

## 文件清单

```
frontend/src/
├── api/
│   └── auth.js                    # 认证API服务
└── views/
    └── auth/
        ├── RegisterView.vue       # 注册页面
        └── LoginView.vue          # 登录页面
```

## 依赖项

所有依赖项已在 `package.json` 中定义：
- Vue 3
- Vue Router
- Pinia
- Axios
- Element Plus
- @element-plus/icons-vue
