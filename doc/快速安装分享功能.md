# 快速安装和测试分享功能

## 📦 安装步骤

### 1. 安装前端依赖

```bash
cd frontend
npm install qrcodejs2
```

### 2. 配置后端

确保 `application.yml` 中配置了正确的基础URL：

```yaml
app:
  base-url: ${APP_BASE_URL:http://localhost:5173}
```

**生产环境**需要设置环境变量：
```bash
export APP_BASE_URL=https://yourdomain.com
```

### 3. 重启服务

#### Docker方式
```bash
docker-compose restart backend frontend
```

#### 本地开发方式
```bash
# 重启后端
cd backend
mvn spring-boot:run

# 重启前端
cd frontend
npm run dev
```

---

## 🧪 测试步骤

### 测试1: 后端API测试

#### 1.1 测试获取分享链接
```bash
curl http://localhost:8080/api/public/share/1
```

**预期响应**:
```json
{
  "success": true,
  "data": {
    "contentUrl": "http://localhost:5173/content/1",
    "title": "内容标题",
    "description": "内容描述...",
    "shareLinks": {
      "wechat": "http://localhost:5173/content/1",
      "weibo": "https://service.weibo.com/share/share.php?url=...",
      "qzone": "https://sns.qzone.qq.com/cgi-bin/qzshare/...",
      "twitter": "https://twitter.com/intent/tweet?url=...",
      "facebook": "https://www.facebook.com/sharer/sharer.php?u=...",
      "linkedin": "https://www.linkedin.com/sharing/share-offsite/?url=...",
      "copy": "http://localhost:5173/content/1"
    }
  }
}
```

#### 1.2 测试记录分享
```bash
curl -X POST "http://localhost:8080/api/public/share/1/record?platform=weibo"
```

**预期响应**:
```json
{
  "success": true,
  "message": "分享记录成功"
}
```

### 测试2: 前端功能测试

#### 2.1 访问内容详情页
```
http://localhost:5173/content/1
```

#### 2.2 点击分享按钮
- 找到"分享"按钮
- 点击按钮
- 应该弹出分享对话框

#### 2.3 测试复制链接
- 在分享对话框中
- 点击"复制链接"按钮
- 应该看到"链接已复制到剪贴板"提示
- 粘贴到浏览器地址栏验证

#### 2.4 测试微信分享
- 点击"微信"图标
- 应该弹出二维码对话框
- 二维码应该正确显示
- 使用微信扫描二维码测试

#### 2.5 测试社交媒体分享
- 点击"微博"图标
- 应该打开新窗口到微博分享页面
- 验证URL和标题是否正确

- 点击"QQ空间"图标
- 应该打开新窗口到QQ空间分享页面

- 点击"Twitter"图标
- 应该打开新窗口到Twitter分享页面

- 点击"Facebook"图标
- 应该打开新窗口到Facebook分享页面

- 点击"LinkedIn"图标
- 应该打开新窗口到LinkedIn分享页面

### 测试3: 响应式测试

#### 3.1 桌面端测试
- 浏览器窗口最大化
- 打开分享对话框
- 验证布局正常（3列网格）

#### 3.2 移动端测试
- 浏览器窗口缩小到手机尺寸
- 打开分享对话框
- 验证布局正常（2列网格）

### 测试4: 错误处理测试

#### 4.1 测试不存在的内容
```bash
curl http://localhost:8080/api/public/share/99999
```

**预期响应**:
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "内容不存在"
  }
}
```

#### 4.2 测试未发布的内容
- 创建一个草稿内容
- 尝试获取分享链接
- 应该返回错误："只能分享已发布的内容"

---

## ✅ 测试检查清单

### 后端测试
- [ ] API返回正确的分享链接
- [ ] 支持所有平台的分享URL
- [ ] 分享记录功能正常
- [ ] 错误处理正确

### 前端测试
- [ ] 分享按钮显示正常
- [ ] 分享对话框打开正常
- [ ] 复制链接功能正常
- [ ] 微信二维码生成正常
- [ ] 所有社交媒体按钮可点击
- [ ] 社交媒体链接正确
- [ ] 响应式布局正常
- [ ] 图标显示正常

### 用户体验测试
- [ ] 操作流畅
- [ ] 提示信息清晰
- [ ] 加载速度快
- [ ] 无明显bug

---

## 🐛 常见问题

### Q1: 二维码不显示
**原因**: qrcodejs2依赖未安装

**解决**:
```bash
cd frontend
npm install qrcodejs2
npm run dev
```

### Q2: 分享链接错误
**原因**: APP_BASE_URL配置不正确

**解决**:
检查 `application.yml`:
```yaml
app:
  base-url: http://localhost:5173  # 确保是前端地址
```

### Q3: 社交媒体链接打不开
**原因**: URL编码问题

**解决**:
检查ShareService中的URL编码是否正确

### Q4: 复制链接失败
**原因**: 浏览器不支持Clipboard API

**解决**:
代码已包含降级方案，使用document.execCommand

---

## 📝 测试报告模板

### 测试环境
- 操作系统: _______________
- 浏览器: _______________
- 前端地址: http://localhost:5173
- 后端地址: http://localhost:8080
- 测试日期: _______________

### 测试结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 后端API | [ ] 通过 [ ] 失败 | |
| 分享对话框 | [ ] 通过 [ ] 失败 | |
| 复制链接 | [ ] 通过 [ ] 失败 | |
| 微信二维码 | [ ] 通过 [ ] 失败 | |
| 微博分享 | [ ] 通过 [ ] 失败 | |
| QQ空间分享 | [ ] 通过 [ ] 失败 | |
| Twitter分享 | [ ] 通过 [ ] 失败 | |
| Facebook分享 | [ ] 通过 [ ] 失败 | |
| LinkedIn分享 | [ ] 通过 [ ] 失败 | |
| 响应式布局 | [ ] 通过 [ ] 失败 | |

### 发现的问题
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### 测试结论
[ ] 通过，可以发布  
[ ] 有问题，需要修复

---

## 🎯 下一步

测试通过后：
1. 提交代码到版本控制
2. 更新文档
3. 通知团队成员
4. 继续开发下一个功能（多级分类）

---

**祝测试顺利！** 🎉
